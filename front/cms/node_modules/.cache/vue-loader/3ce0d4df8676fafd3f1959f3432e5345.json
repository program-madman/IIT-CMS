{"remainingRequest":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liuguanghui/Documents/cms_code/my-message/cms/src/components/dashboard/appBar.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/src/components/dashboard/appBar.vue","mtime":1638535925258},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCBteVNlYXJjaCBmcm9tICIuLi9zdG9yZS9tb2R1bGVzL215U2VhcmNoIjsKaW1wb3J0IHsgbWFwU3RhdGUsIG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IHsgZ2V0VXNlck1lc3NhZ2VMaXN0LCBnZXRNZXNzYWdlVW5yZWFkQ291bnQsbWFya01lc3NhZ2VSZWFkT25lIH0gZnJvbSAiQC9hcGkvZ2V0RGF0YS5qcyI7CmltcG9ydCB7IHNob3dNc2dUZXh0IH0gZnJvbSAiQC91dGlscy9jb21tb24uanMiOwppbXBvcnQgeyBFdmVudEJ1cyB9IGZyb20gIkAvdXRpbHMvZXZlbnQtYnVzIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBtb3VudGVkKCkgewoKICAgIEV2ZW50QnVzLiRvbigibWFrZUFsbE1zZ1JlYWQiLCAobXNnKSA9PiB7CiAgICAgIC8vIOaJgOaciea2iOaBr+agh+iusOW3suivu++8jOaKiuagh+iusOWOu+aOiQogICAgICBjb25zb2xlLmxvZygiIyMjIyMjIyMgcmVjZWl2ZSBtZXNzYWdlICMjIyMjIyMgIiArIG1zZyk7CiAgICAgIHRoaXMubXNnQ291bnQgPSAwOwogICAgfSk7CgogICAgIEV2ZW50QnVzLiRvbigibWFya1NpbmdsZVJlYWQiLCAobXNnKSA9PiB7CiAgICAgIC8vIOaIkeS7rOS4jemcgOimgeWcqOiOt+WPluS4gOasoeacquivu+a2iOaBr+aVsOmHj++8jOWmguaenOWGjeasoeWIt+aWsOeahOivne+8jOWPr+iDveeci+S4iuWOu+S8muacieacquivu+a2iOaBr+WPr+iDvei/mOS8muWkmueahOe7k+aenAogICAgICBjb25zb2xlLmxvZygiIyMjIyMjIyMgcmVjZWl2ZSBtZXNzYWdlICMjIyMjIyMgIiArIG1zZyk7CiAgICAgIHRoaXMubXNnQ291bnQtLTsKICAgIH0pOwoKICAgICBnZXRNZXNzYWdlVW5yZWFkQ291bnQoKQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIC8vY29uc29sZS5sb2coIiMjIyMjIyMjIHVucmVhZCBjb3VubnQgPT09PT09PT09PiAjIyMjIyMjICIgKyBKU09OLnN0cmluZ2lmeShyZXNwb25zZSkpOwogICAgICAgICAgaWYocmVzcG9uc2UuZGF0YSAhPSBudWxsICYmIHJlc3BvbnNlLmRhdGEgPiAwKSB7CiAgICAgICAgICAgIHRoaXMubXNnQ291bnQgPSByZXNwb25zZS5kYXRhCiAgICAgICAgICB9CiAgICAgIH0pLmNhdGNoKCk7CgogICAgZ2V0VXNlck1lc3NhZ2VMaXN0KDEsIDMpCiAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIC8vc2hvd01zZ1RleHQoIjEiKQogICAgICAgIC8vY29uc29sZS5sb2coIiMjIyMjIyMjIHVucmVhZCBjb3VubnQgPT09PT09PT09PiAjIyMjIyMjICIgKyBKU09OLnN0cmluZ2lmeShyZXNwb25zZSkpOwogICAgICAgIGlmIChyZXNwb25zZSAhPSBudWxsICYmIHJlc3BvbnNlLmRhdGEgIT0gbnVsbCAmJiByZXNwb25zZS5kYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHRoaXMubXNnSXRlbXMgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm1zZ0l0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGxldCBtc2cgPSB0aGlzLm1zZ0l0ZW1zW2ldOwogICAgICAgICAgICBtc2cub3B0VGV4dCA9IHNob3dNc2dUZXh0KG1zZy5vcGVyYXRpb24pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkKICAgICAgLmNhdGNoKCk7CiAgfSwKCiAgZGF0YTogKCkgPT4gKHsKICAgIGxhbnZhbDogIueugOS9k+S4reaWhyIsCiAgICBkcmF3ZXI6IHRydWUsCiAgICBtc2dDb3VudDogMCwKICAgIGxhbml0ZW1zOiBbCiAgICAgIHsgdGl0bGU6ICLnroDkvZPkuK3mlociLCB2YWw6ICJ6aCIgfSwKICAgICAgeyB0aXRsZTogIkVuZ2xpc2giLCB2YWw6ICJlbiIgfSwKICAgIF0sCiAgICAvL2RlZmF1bHQgbWVzc2FnZQogICAgbXNnSXRlbXM6IFsKICAgICAgewogICAgICAgIGlkOi0xLAogICAgICAgIG9wZXJhdG9yOiAiIiwKICAgICAgICBvcHRUZXh0OiAi5rKh5pyJ5paw5raI5oGvIiwKICAgICAgICB0aXRsZTogIiIsCiAgICAgIH0sCiAgICBdLAogIH0pLAoKICBjb21wdXRlZDogewogICAgLi4ubWFwU3RhdGUoewogICAgICB1c2VyOiAoc3RhdGUpID0+IHN0YXRlLnVzZXIudXNlckluZm8sCiAgICB9KSwKICAgIC4uLm1hcEdldHRlcnMoewogICAgICAvLyDmioogYHRoaXMuZG9uZUNvdW50YCDmmKDlsITkuLogYHRoaXMuJHN0b3JlLmdldHRlcnMuZG9uZVRvZG9zQ291bnRgCiAgICAgIGhhc0VkaXRQZXJtaXNzaW9uOiAidXNlci9oYXNFZGl0UGVybWlzc2lvbiIsCiAgICB9KSwKICB9LAoKICBtZXRob2RzOiB7CgogICAgbWFya09uY2VSZWFkKG1lc3NhZ2UpIHsKICAgICAgaWYobWVzc2FnZS5pZCA9PT0gLTEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy4kcm91dGVyLnB1c2goe25hbWU6ICJhcnRjbGVEZXRhaWwiLHBhcmFtczoge2lkOm1lc3NhZ2UuaWR9fSk7CiAgICAgIG1hcmtNZXNzYWdlUmVhZE9uZShtZXNzYWdlLm1lc3NhZ2VJZCkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmKHJlc3BvbnNlICE9IG51bGwgJiYgcmVzcG9uc2UuY29kZSA9PT0wICYmIHJlc3BvbnNlLm1lc3NhZ2UgPT09ICJzdWNjZXNzIil7CiAgICAgICAgICAgICAgbWVzc2FnZS5pc1JlYWQgPSB0cnVlOwogICAgICAgICAgICAgIHRoaXMubXNnQ291bnQtLTsKICAgICAgICAgIH0gIAogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCk7CiAgICB9LAoKICAgIG9uRHJhd2VyQ2xpY2soKSB7CiAgICAgIHRoaXMuZHJhd2VyID0gIXRoaXMuZHJhd2VyOwogICAgICB0aGlzLiRlbWl0KCJjaGFuZ2UiLCB0aGlzLmRyYXdlcik7CiAgICB9LAogICAgY2hhbmdlTGFuZ3VhZ2UoaXRlbSkgewogICAgICB0aGlzLmxhbnZhbCA9IGl0ZW0udGl0bGU7CiAgICAgIHRoaXMuJGkxOG4ubG9jYWxlID0gaXRlbS52YWw7CiAgICB9LAoKICAgIHRvTWVzc2FnZUNlbnRlcigpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBuYW1lOiAibWVzc2FnZUNlbnRlciIgfSk7CiAgICB9LAogICAgLy8g6YCJ5Lit5paH56ug6Lez6L2s6K+m5oOFCiAgICBzZWxlY3RNc2coaW5kZXgpIHsKICAgICAgY29uc29sZS5sb2coIj09PT09PT09PT09PT09PT09PT0iICsgaW5kZXgpOwogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IG5hbWU6ICJhcnRjbGVEZXRhaWwiIH0pOwogICAgICAvL3RoaXMuJHJvdXRlci5wdXNoKHsgbmFtZTogImFydGNsZURldGFpbCIsIHBhcmFtczogdGhpcy5tc2dJdGVtc1tpbmRleF0gfSk7CiAgICAgIC8vdGhpcy4kcm91dGVyLnB1c2goeyBwYXRoOiAnL2FydGNsZURldGFpbCcsbmFtZToidGVzdCIsIHF1ZXJ5OiB7IHVzZXJJZDogMTIzIH19KQogICAgfSwKICAgIG5ld0FydGljbGUoKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgbmFtZTogInB1Ymxpc2hBcnRpY2xlIiB9KTsKICAgIH0sCiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy4kaTE4bi5sb2NhbGUgPSAiemgiOwogIH0sCiAgLy/ov4fmu6TmloflrZcKICBmaWx0ZXJzOiB7CiAgICBsZW5naHRoKHRleHQsIGxlbmd0aCwgc3VmZml4ID0gIi4uLiIpIHsKICAgICAgaWYgKCF0ZXh0KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0ZXh0Lmxlbmd0aCA8PSBsZW5ndGgpIHsKICAgICAgICByZXR1cm4gdGV4dDsKICAgICAgfQogICAgICByZXR1cm4gKHRleHQgKyAiIikucmVwbGFjZSgvXG4vZywgIjxici8+Iikuc3Vic3RyaW5nKDAsIGxlbmd0aCkgKyBzdWZmaXg7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["appBar.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0GA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"appBar.vue","sourceRoot":"src/components/dashboard","sourcesContent":["<template>\n  <v-app-bar id=\"app-bar\" app flat link height=\"64\" class=\"app-bar-style\">\n    <v-app-bar-nav-icon @click=\"onDrawerClick\"> </v-app-bar-nav-icon>\n\n    <v-spacer></v-spacer>\n    <v-btn\n      color=\"primary\"\n      dark\n      class=\"pl-2\"\n      height=\"36\"\n      min-width=\"105\"\n      v-if=\"hasEditPermission\"\n      @click=\"newArticle\"\n    >\n      {{ $t(\"new_message\") }}\n    </v-btn>\n    <!-- 消息通知 -->\n    <v-menu offset-y>\n      <template v-slot:activator=\"{ on, attrs }\">\n        <v-btn class=\"ml-2\" min-width=\"0\" text v-bind=\"attrs\" v-on=\"on\">\n          <v-badge v-if=\"msgCount > 0\" color=\"red\" overlap bordered>\n            <template v-slot:badge>\n              <span>{{ msgCount > 99 ? 99 : msgCount }}</span>\n            </template>\n            <v-icon>mdi-bell</v-icon>\n          </v-badge>\n          <v-icon v-if=\"msgCount <= 0\">mdi-bell</v-icon>\n        </v-btn>\n      </template>\n      <v-card>\n        <v-card-text>\n          <div @click=\"markOnceRead(item)\" disabled v-for=\"(item, cindex) in msgItems\" :key=\"cindex\">\n            <v-divider />\n            <div class=\"pa-0 ma-0 mt-2\">\n              <span class=\"ml-n2\" v-if=\"item.isRead === false\">\n                <v-icon dense large color=\"red darken-3\"\n                  >mdi-circle-small</v-icon\n                >\n              </span>\n              <span class=\"ml-7\" v-else></span>\n              <span>{{ item.operator }}</span>\n              <span class=\"ml-1 mr-2\">-</span>\n              <span class=\"ml-1\">{{item.optText}}</span>\n              <span class=\"ml-1 mr-2\">-</span>\n\n              <v-btn\n                small\n                text\n                color=\"blue lighten-2\"\n                @click=\"selectMsg(cindex)\"\n              >\n                {{ item.messageTitle | lenghth(15) }}</v-btn\n              >\n            </div>\n          </div>\n        </v-card-text>\n\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn\n            align=\"center\"\n            color=\"blue darken-1\"\n            text\n            @click=\"toMessageCenter\"\n          >\n            查看全部信息\n          </v-btn>\n          <v-spacer></v-spacer>\n        </v-card-actions>\n      </v-card>\n    </v-menu>\n    <!-- 语言选择 -->\n    <v-menu\n      bottom\n      left\n      offset-y\n      origin=\"top right\"\n      min-width=\"0\"\n      transition=\"scale-transition\"\n    >\n      <template v-slot:activator=\"{ attrs, on }\">\n        <v-btn class=\"ml-2\" min-width=\"110px\" text v-bind=\"attrs\" v-on=\"on\">\n          <v-icon>mdi-translate </v-icon>{{ lanval }}\n        </v-btn>\n      </template>\n      <v-list v-model=\"lanitems.val\">\n        <v-list-item\n          v-for=\"(item, index) in lanitems\"\n          :key=\"index\"\n          :val=\"lanitems.val\"\n          @click=\"changeLanguage(item)\"\n        >\n          <v-list-item-title>{{ item.title }}</v-list-item-title>\n        </v-list-item>\n      </v-list>\n    </v-menu>\n    <!-- <v-btn> 退出 </v-btn> -->\n\n    <div class=\"mr-1 ml-6\">\n      <div class=\"app-bar-user\">{{ user.name }}</div>\n      <span class=\"app-bar-user-post\">{{ user.department }}</span>\n      <span class=\"app-bar-user-post ml-2\">{{ user.positionName }}</span>\n    </div>\n  </v-app-bar>\n</template>\n<script>\n// import mySearch from \"../store/modules/mySearch\";\nimport { mapState, mapGetters } from \"vuex\";\nimport { getUserMessageList, getMessageUnreadCount,markMessageReadOne } from \"@/api/getData.js\";\nimport { showMsgText } from \"@/utils/common.js\";\nimport { EventBus } from \"@/utils/event-bus\";\n\nexport default {\n  mounted() {\n\n    EventBus.$on(\"makeAllMsgRead\", (msg) => {\n      // 所有消息标记已读，把标记去掉\n      console.log(\"######## receive message ####### \" + msg);\n      this.msgCount = 0;\n    });\n\n     EventBus.$on(\"markSingleRead\", (msg) => {\n      // 我们不需要在获取一次未读消息数量，如果再次刷新的话，可能看上去会有未读消息可能还会多的结果\n      console.log(\"######## receive message ####### \" + msg);\n      this.msgCount--;\n    });\n\n     getMessageUnreadCount()\n      .then((response) => {\n          //console.log(\"######## unread counnt =========> ####### \" + JSON.stringify(response));\n          if(response.data != null && response.data > 0) {\n            this.msgCount = response.data\n          }\n      }).catch();\n\n    getUserMessageList(1, 3)\n      .then((response) => {\n        //showMsgText(\"1\")\n        //console.log(\"######## unread counnt =========> ####### \" + JSON.stringify(response));\n        if (response != null && response.data != null && response.data.length > 0) {\n          this.msgItems = response.data;\n          for (let i = 0; i < this.msgItems.length; i++) {\n            let msg = this.msgItems[i];\n            msg.optText = showMsgText(msg.operation);\n          }\n        }\n      })\n      .catch();\n  },\n\n  data: () => ({\n    lanval: \"简体中文\",\n    drawer: true,\n    msgCount: 0,\n    lanitems: [\n      { title: \"简体中文\", val: \"zh\" },\n      { title: \"English\", val: \"en\" },\n    ],\n    //default message\n    msgItems: [\n      {\n        id:-1,\n        operator: \"\",\n        optText: \"没有新消息\",\n        title: \"\",\n      },\n    ],\n  }),\n\n  computed: {\n    ...mapState({\n      user: (state) => state.user.userInfo,\n    }),\n    ...mapGetters({\n      // 把 `this.doneCount` 映射为 `this.$store.getters.doneTodosCount`\n      hasEditPermission: \"user/hasEditPermission\",\n    }),\n  },\n\n  methods: {\n\n    markOnceRead(message) {\n      if(message.id === -1) {\n        return;\n      }\n      this.$router.push({name: \"artcleDetail\",params: {id:message.id}});\n      markMessageReadOne(message.messageId)\n        .then((response) => {\n          if(response != null && response.code ===0 && response.message === \"success\"){\n              message.isRead = true;\n              this.msgCount--;\n          }  \n        })\n        .catch();\n    },\n\n    onDrawerClick() {\n      this.drawer = !this.drawer;\n      this.$emit(\"change\", this.drawer);\n    },\n    changeLanguage(item) {\n      this.lanval = item.title;\n      this.$i18n.locale = item.val;\n    },\n\n    toMessageCenter() {\n      this.$router.push({ name: \"messageCenter\" });\n    },\n    // 选中文章跳转详情\n    selectMsg(index) {\n      console.log(\"===================\" + index);\n      this.$router.push({ name: \"artcleDetail\" });\n      //this.$router.push({ name: \"artcleDetail\", params: this.msgItems[index] });\n      //this.$router.push({ path: '/artcleDetail',name:\"test\", query: { userId: 123 }})\n    },\n    newArticle() {\n      this.$router.push({ name: \"publishArticle\" });\n    },\n  },\n  created() {\n    this.$i18n.locale = \"zh\";\n  },\n  //过滤文字\n  filters: {\n    lenghth(text, length, suffix = \"...\") {\n      if (!text) {\n        return;\n      }\n      if (text.length <= length) {\n        return text;\n      }\n      return (text + \"\").replace(/\\n/g, \"<br/>\").substring(0, length) + suffix;\n    },\n  },\n};\n</script>\n<style scoped>\n.app-bar-style {\n  background: #ffffffff !important;\n  box-shadow: inset 0px -1px 0px 0px #e4e8ebff !important;\n}\n.app-bar-user {\n  color: #333333ff;\n  font-family: Noto Sans S Chinese;\n  font-weight: bold;\n  font-size: 16px;\n  line-height: normal;\n  letter-spacing: 0px;\n  text-align: left;\n}\n.app-bar-user-post {\n  color: #999999ff;\n  font-family: Noto Sans S Chinese;\n  font-weight: regular;\n  font-size: 12px;\n  line-height: normal;\n  letter-spacing: 0px;\n  text-align: left;\n}\n</style>\n"]}]}