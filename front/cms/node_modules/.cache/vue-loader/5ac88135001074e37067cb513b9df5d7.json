{"remainingRequest":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liuguanghui/Documents/cms_code/my-message/cms/src/views/page/publishArticle/index.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/src/views/page/publishArticle/index.vue","mtime":1638803771708},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoucHVibGlzaF9jb250ZW50IHsKICBkaXNwbGF5OiBibG9jazsKICBvdmVyZmxvdzogc2Nyb2xsOwp9Ci5hcHBlbmQtY29udGVudCAudi1idG4gewogIGNvbG9yOiAjMTg2N2MwZmY7CiAgZm9udC1mYW1pbHk6IFBpbmdGYW5nIFNDOwogIGZvbnQtd2VpZ2h0OiByZWd1bGFyOwogIGZvbnQtc2l6ZTogMTJweDsKICBsaW5lLWhlaWdodDogMThweDsKICBsZXR0ZXItc3BhY2luZzogMHB4OwogIHRleHQtYWxpZ246IGxlZnQ7CiAgdmVydGljYWwtYWxpZ246IHRvcDsKfQoKLmFwcGVuZC1jb250ZW50CiAgLnYtYnRuLS1wbGFpbjpub3QoLnYtYnRuLS1hY3RpdmUpOm5vdCgudi1idG4tLWxvYWRpbmcpOm5vdCg6Zm9jdXMpOm5vdCg6aG92ZXIpCiAgLnYtYnRuX19jb250ZW50IHsKICBvcGFjaXR5OiAxOwp9CgouYXBwZW5kaXggLnYtaWNvbiB7CiAgbWFyZ2luLWxlZnQ6IDBweCAhaW1wb3J0YW50OwogIG1hcmdpbi1yaWdodDogNHB4ICFpbXBvcnRhbnQ7Cn0KCi5hcHBlbmRpeCAuZGl2aWRlciB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHdpZHRoOiAxcHg7CiAgaGVpZ2h0OiAxMnB4OwogIGJhY2tncm91bmQ6ICNlNGU4ZWJmZjsKICBtYXJnaW4tYm90dG9tOiAzcHg7Cn0KCi5hcHBlbmRpeC1oaW50IHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgY29sb3I6ICM5OTk5OTlmZjsKICBoZWlnaHQ6IDE4cHg7CiAgZm9udC1mYW1pbHk6IFBpbmdGYW5nIFNDOwogIGZvbnQtd2VpZ2h0OiByZWd1bGFyOwogIGZvbnQtc2l6ZTogMTJweDsKICBsaW5lLWhlaWdodDogbm9ybWFsOwogIGxldHRlci1zcGFjaW5nOiAwcHg7CiAgdGV4dC1hbGlnbjogbGVmdDsKICBtYXJnaW4tbGVmdDogOHB4OwogIHZlcnRpY2FsLWFsaWduOiB0b3A7Cn0KCi8qIHZvdGUgZGlhbG9nICovCi52b3RlLW9wdGlvbiAudi1idG4gewogIGNvbG9yOiAjMTg2N2MwZmY7CiAgZm9udC1mYW1pbHk6IFBpbmdGYW5nIFNDOwogIGZvbnQtd2VpZ2h0OiByZWd1bGFyOwogIGZvbnQtc2l6ZTogMTRweDsKICBsaW5lLWhlaWdodDogMThweDsKICBsZXR0ZXItc3BhY2luZzogMHB4OwogIHRleHQtYWxpZ246IGxlZnQ7CiAgdmVydGljYWwtYWxpZ246IHRvcDsKfQoKLnZvdGUtb3B0aW9uCiAgLnYtYnRuLS1wbGFpbjpub3QoLnYtYnRuLS1hY3RpdmUpOm5vdCgudi1idG4tLWxvYWRpbmcpOm5vdCg6Zm9jdXMpOm5vdCg6aG92ZXIpCiAgLnYtYnRuX19jb250ZW50IHsKICBvcGFjaXR5OiAxOwp9Cgoudm90ZS1jaGVja2JveC1sYWJlbCB7CiAgY29sb3I6ICMzMzMzMzNmZjsKICBmb250LWZhbWlseTogUGluZ0ZhbmcgU0M7CiAgZm9udC13ZWlnaHQ6IHJlZ3VsYXI7CiAgZm9udC1zaXplOiAxNHB4OwogIGxpbmUtaGVpZ2h0OiBub3JtYWw7CiAgbGV0dGVyLXNwYWNpbmc6IDBweDsKICB0ZXh0LWFsaWduOiBsZWZ0OwogIG1hcmdpbi1yaWdodDogOHB4Owp9Cgoudm90ZS1jaGVja2JveCB7CiAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgZm9udC1zaXplOiAxNHB4OwogIG1hcmdpbjogMCAhaW1wb3J0YW50OwogIHBhZGRpbmc6IDAgIWltcG9ydGFudDsKICBtYXJnaW4tdG9wOiAzcHggIWltcG9ydGFudDsKfQoKLnZvdGUtY2hlY2tib3ggLnYtaW5wdXRfX3Nsb3QgewogIG1hcmdpbi1ib3R0b206IDAgIWltcG9ydGFudDsKICBwYWRkaW5nLXJpZ2h0OiAwOwp9Ci52b3RlLWNoZWNrYm94IC52LWlucHV0X19jb250cm9sIHsKICBoZWlnaHQ6IDE0cHggIWltcG9ydGFudDsKfQoKLnZvdGUtY2hlY2tib3ggLnYtaW5wdXQtLXNlbGVjdGlvbi1jb250cm9sc19faW5wdXQgewogIHBhZGRpbmc6IDA7CiAgbWFyZ2luOiAwOwogIGhlaWdodDogMTRweCAhaW1wb3J0YW50OwogIHdpZHRoOiAxNHB4ICFpbXBvcnRhbnQ7Cn0KLyogdm90ZSBkaWFsb2cgKi8KCi5maWxlcy1jYXRlZ29yeSB7CiAgb3BhY2l0eTogMC44MDAwMDAwMTE5MjA5Mjk7CiAgY29sb3I6ICMzMzMzMzNmZjsKICBmb250LWZhbWlseTogUGluZ0ZhbmcgU0M7CiAgZm9udC13ZWlnaHQ6IHNlbWlib2xkOwogIGZvbnQtc2l6ZTogMTRweDsKICBsaW5lLWhlaWdodDogMjBweDsKICBsZXR0ZXItc3BhY2luZzogMHB4Owp9CgouZmlsZS1pdGVtIHsKICBtYXJnaW4tYm90dG9tOiAxcHg7Cn0KCi50aW1lX2lucHV0IC52LWlucHV0X19zbG90IHsKICBwYWRkaW5nLXJpZ2h0OiAwcHggIWltcG9ydGFudDsKfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAw5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/page/publishArticle","sourcesContent":["<template>\n  <v-container fluid class=\"pa-0 publish_content\">\n    <!-- 文章标题 -->\n    <title-editor v-model=\"title\" :error-messages=\"titleErrorMessage\" />\n\n    <!-- 正文编辑器 -->\n    <app-editor ref=\"editor\" v-model=\"content\" />\n\n    <div class=\"append-content\">\n      <div class=\"appendix mt-4 ml-5 mr-5\" height=\"18px\">\n        <v-btn\n          plain\n          text\n          color=\"#1867c0ff\"\n          :disabled=\"vote.enable\"\n          :ripple=\"false\"\n          @click=\"voteDialog = true\"\n          height=\"18px\"\n          class=\"pa-0 ma-0\"\n        >\n          <v-icon height=\"16px\" width=\"16px\" left> mdi-vote-outline </v-icon>\n          添加投票\n        </v-btn>\n\n        <div class=\"ml-4 mr-4 divider\" vertical></div>\n        <v-btn\n          plain\n          text\n          color=\"#1867c0ff\"\n          :ripple=\"false\"\n          height=\"18px\"\n          class=\"pa-0 ma-0\"\n          @click=\"uploadFileN\"\n        >\n          <v-icon height=\"16px\" width=\"16px\" left> mdi-paperclip </v-icon>\n          添加附件\n          <input\n            ref=\"uploadFileN\"\n            type=\"file\"\n            @change=\"fileUpload($event, false)\"\n            multiple=\"multiple\"\n            accept=\".docx,.doc,.pdf,.jpg,.xls,.xlsx,.txt\"\n            hidden\n          />\n        </v-btn>\n        <div class=\"ml-4 mr-4 divider\" vertical></div>\n        <v-btn\n          plain\n          text\n          color=\"#1867c0ff\"\n          :ripple=\"false\"\n          height=\"18px\"\n          class=\"pa-0 ma-0\"\n          @click=\"uploadFileD\"\n        >\n          <v-icon height=\"16px\" width=\"16px\" left> mdi-paperclip </v-icon>\n          添加定向附件\n          <input\n            ref=\"uploadFileD\"\n            type=\"file\"\n            @change=\"fileUpload($event, true)\"\n            multiple=\"multiple\"\n            accept=\".docx,.doc,.pdf,.jpg,.xls,.xlsx,.txt\"\n            hidden\n          />\n        </v-btn>\n\n        <span class=\"appendix-hint\"\n          >定向附件文件名格式如下：[70101010]******************，中括号中为发送经销商代码</span\n        >\n      </div>\n      <!-- 添加附件按钮栏 结束 -->\n      <!-- 添加投票dialog 开始 -->\n      <v-dialog width=\"546\" v-model=\"voteDialog\" :disabled=\"vote.enable\">\n        <v-card>\n          <v-card-title>\n            <span>添加投票</span>\n          </v-card-title>\n          <v-form ref=\"form\" lazy-validation>\n            <vote-option\n              placeholder=\"请输入投票主题\"\n              errorMessage=\"投票主题不能为空\"\n              class=\"ml-7 mr-7\"\n              v-model=\"voteTemp.topic\"\n            />\n\n            <div class=\"mt-6\">\n              <vote-option\n                v-for=\"(item, hindex) in voteTemp.voteOptions\"\n                :key=\"hindex\"\n                placeholder=\"请输入投票内容\"\n                :errorMessage=\"hindex > 1 ? null : '投票内容不能为空'\"\n                v-model=\"item.value\"\n                :enableDelete=\"hindex > 1\"\n                @onDelete=\"deleteItem(hindex)\"\n              />\n            </div>\n            <div class=\"vote-option\">\n              <v-btn\n                plain\n                text\n                :ripple=\"false\"\n                height=\"18px\"\n                class=\"pa-0 ma-0 ml-8\"\n                @click=\"addItem\"\n              >\n                <v-icon height=\"16px\" width=\"16px\" left>\n                  mdi-plus-circle-outline\n                </v-icon>\n                添加投票选项\n              </v-btn>\n            </div>\n\n            <time-picker v-model=\"voteTemp.endTime\" :minTime=\"new Date()\">\n              <v-text-field\n                placeholder=\"投票结束时间\"\n                hide-details=\"auto\"\n                single-line\n                maxlength=\"40\"\n                v-model=\"voteTemp.endTime\"\n                :rules=\"[(value) => !!value || '投票结束时间不能为空']\"\n                required\n                outlined\n                append-icon=\"mdi-menu-down\"\n                class=\"title time_input ml-7 mt-5\"\n                style=\"display: inline-flex; width: 455px\"\n                readonly\n              />\n              <span\n                style=\"height: 16px; width: 16px; color: red; margin-left: 13px\"\n              >\n                *</span\n              >\n            </time-picker>\n            <div style=\"margin-top: 24px; height: 60px\">\n              <v-btn\n                min-width=\"105px\"\n                height=\"36px\"\n                depressed\n                dark\n                outlined\n                color=\"#1867C0FF\"\n                style=\"margin-left: 157px; margin-right: 24px\"\n                @click=\"voteDialog = false\"\n              >\n                取消\n              </v-btn>\n              <v-btn\n                min-width=\"105px\"\n                height=\"36px\"\n                depressed\n                dark\n                color=\"blue\"\n                @click=\"voteSave\"\n              >\n                确认\n              </v-btn>\n            </div>\n          </v-form>\n        </v-card>\n      </v-dialog>\n      <!-- 添加投票dialog 结束 -->\n      <!-- 投票显示区域 -->\n      <vote\n        :vote=\"vote\"\n        @onDelete=\"onVoteDelete\"\n        @onUpdate=\"voteDialog = true\"\n        v-if=\"vote.enable\"\n        class=\"ml-5 mt-4\"\n      />\n      <!-- 文件附件部分 开始 -->\n      <div class=\"ml-5 mt-4 mr-5\">\n        <div v-if=\"uploadFileNormal.length > 0\">\n          <v-row class=\"ma-0 pa-0\">\n            <span class=\"files-category mr-6\">\n              普通附件({{ uploadFileNormal.length }})\n            </span>\n            <v-btn\n              depressed\n              plain\n              text\n              :ripple=\"false\"\n              height=\"20px\"\n              min-width=\"24px\"\n              class=\"pa-0 ma-0\"\n              @click=\"uploadFileNormal = []\"\n            >\n              全部删除\n            </v-btn>\n          </v-row>\n          <v-row no-gutters class=\"pa-0 ma-0 mt-2\">\n            <file-item\n              v-for=\"(item, hindex) in uploadFileNormal\"\n              :key=\"hindex\"\n              @onDelete=\"onDeleteFile(hindex, false)\"\n              class=\"pa-0 mr-4 file-item\"\n              :apFile=\"item\"\n            ></file-item>\n          </v-row>\n        </div>\n        <div v-if=\"uploadFileDirect.length > 0\">\n          <v-row class=\"ma-0 mt-4 pa-0\" align=\"center\">\n            <span class=\"files-category mr-6\"\n              >定向附件({{ uploadFileDirect.length }})</span\n            >\n            <v-btn\n              depressed\n              plain\n              text\n              :ripple=\"false\"\n              height=\"20px\"\n              min-width=\"24px\"\n              class=\"pa-0 ma-0\"\n              @click=\"uploadFileDirect = []\"\n            >\n              全部删除\n            </v-btn>\n          </v-row>\n          <v-row no-gutters class=\"pa-0 ma-0 mt-2\">\n            <file-item\n              v-for=\"(item, hindex) in uploadFileDirect\"\n              :key=\"hindex\"\n              @onDelete=\"onDeleteFile(hindex, true)\"\n              class=\"pa-0 mr-4 file-item\"\n              :apFile=\"item\"\n            ></file-item>\n          </v-row>\n        </div>\n      </div>\n    </div>\n\n    <div style=\"height: 128px; display: block\"></div>\n\n    <!-- 底部按钮 -->\n    <v-footer padless fixed height=\"64\">\n      <v-spacer></v-spacer>\n      <v-btn\n        class=\"mr-6\"\n        min-width=\"105px\"\n        outlined\n        depressed\n        dark\n        color=\"#1867C0FF\"\n        @click=\"saveArticle\"\n      >\n        保存\n      </v-btn>\n      <v-btn\n        class=\"mr-6\"\n        width=\"105px\"\n        height=\"36px\"\n        outlined\n        depressed\n        dark\n        color=\"#1867C0FF\"\n        @click=\"\n          preview = precondition();\n          closeSnack();\n        \"\n      >\n        预览\n      </v-btn>\n      <v-btn\n        class=\"mr-8\"\n        min-width=\"105px\"\n        depressed\n        dark\n        color=\"blue\"\n        @click=\"\n          publishArticle();\n          closeSnack();\n        \"\n      >\n        发布\n      </v-btn>\n    </v-footer>\n    <preview\n      :open=\"preview && $route.path == '/publishArticle'\"\n      @closeDialog=\"preview = false\"\n      :uploadFileDirect=\"uploadFileDirect\"\n      :uploadFileNormal=\"uploadFileNormal\"\n      :vote=\"vote\"\n      :title=\"title\"\n      :content=\"content\"\n    />\n    <publish\n      :open=\"publish && $route.path == '/publishArticle'\"\n      :id=\"id\"\n      :voteEnable=\"vote.enable\"\n      :dealer=\"delearList\"\n      @closeDialog=\"publish = false\"\n    />\n    <confirm ref=\"confirm\" />\n  </v-container>\n</template>\n<script>\nimport {\n  saveMessage,\n  getArticleDetail,\n  saveVote,\n  uploadFile,\n  dealerCodeValid,\n} from \"@/api/getData.js\";\nimport { highLightAllText } from \"@/utils/articleUtils.js\";\nimport { Debounce, Throttle } from \"@/utils/tools.js\";\nimport { showSnackbar, closeSnackbar } from \"@/utils/snackbar.js\";\nimport { isNull } from \"@/utils/stringUtils.js\";\nimport { offsetMonthTime } from \"@/utils/timeFormate.js\";\nimport {\n  getUploadRealFileNameByPath,\n  checkUploadFileType,\n  readFileSizeUnit,\n  getDistributorNumberByFileName,\n} from \"@/utils/filesUtils.js\";\nconst voteDefault = {\n  id: null,\n  enable: false,\n  topic: \"\",\n  voteType: false,\n  voteOptions: [{}, {}],\n  endTime: offsetMonthTime(1).format(\"yyyy-MM-dd hh:mm:ss\"),\n};\nexport default {\n  data() {\n    return {\n      id: null,\n      title: \"\",\n      content: \"\",\n      titleErrorMessage: \"\",\n\n      maxTime: offsetMonthTime(1),\n      vote: {\n        enable: false,\n      },\n      voteTemp: {\n        id: null,\n        enable: false,\n        topic: \"\",\n        voteType: false,\n        voteOptions: [{}, {}],\n        endTime: offsetMonthTime(1).format(\"yyyy-MM-dd hh:mm:ss\"),\n      },\n      voteDialog: false,\n      uploadFileNormal: [],\n      uploadFileDirect: [],\n      delearList: [],\n      distributorNumber: [\"79601019\", \"79601028\"],\n      preview: false,\n      publish: false,\n      needSave: false,\n      autoSaving: false,\n    };\n  },\n  components: {\n    appEditor: () => import(\"./editor.vue\"),\n    titleEditor: () => import(\"./title.vue\"),\n    vote: () => import(\"./vote\"),\n    voteOption: () => import(\"./voteOption.vue\"),\n    fileItem: () => import(\"./fileOption.vue\"),\n    timePicker: () => import(\"./timePicker.vue\"),\n    preview: () => import(\"./preview.vue\"),\n    publish: () => import(\"./publish.vue\"),\n    confirm: () => import(\"@/components/base/conform.vue\"),\n  },\n\n  beforeRouteUpdate(to, from, next) {\n    if (this.needSave) {\n      this.$refs.confirm\n        .confirm(\n          \"您当前有修改的信息未保存，离开当前页面您输入的信息将不会被保存。\"\n        )\n        .then(() => {\n          next(true);\n          this.reEditIfNeed(to.query.id);\n        })\n        .catch(() => next(false));\n    } else {\n      next(true);\n\n      if (this.reEditIfNeed(to.query.id)) return;\n      this.saveAsNewMessage(to.params);\n    }\n  },\n\n  beforeRouteLeave(to, from, next) {\n    this.closeSnack();\n    if (this.needSave) {\n      this.$refs.confirm\n        .confirm(\n          \"您当前有修改的信息未保存，离开当前页面您输入的信息将不会被保存。\"\n        )\n        .then(() => next(true))\n        .catch(() => next(false));\n    } else {\n      next(true);\n    }\n  },\n  mounted() {\n    if (!this.reEditIfNeed(this.$route.query.id)) {\n      this.saveAsNewMessage(this.$route.params);\n    }\n    window.addEventListener(\"beforeunload\", this.beforeunloadHandler);\n  },\n  destroyed() {\n    window.removeEventListener(\"beforeunload\", this.beforeunloadHandler);\n  },\n\n  methods: {\n    beforeunloadHandler(e) {\n      if (e) {\n        e.returnValue = \"关闭提示\";\n      }\n      return \"关闭提示\";\n    },\n    saveAsNewMessage(params) {\n      console.debug(\"public======>\" + params);\n      if (params == null || typeof params == \"undefined\") return;\n      let id = params.id;\n      if (!id || typeof id == \"undefined\" || isNaN(id)) return;\n\n      this.id = null;\n      this.restoreMessage(id, true);\n    },\n    reEditIfNeed(id) {\n      if (!id || typeof id == \"undefined\") return false;\n\n      id = Number(window.atob(id));\n      if (id == null || isNaN(id) || this.id == id) return false;\n      this.id = id;\n      this.restoreMessage(id);\n      return true;\n    },\n\n    restoreMessage(id, isNew = false) {\n      this.clearContent();\n      getArticleDetail(id)\n        .then((res) => {\n          if (res == null || typeof res == undefined) return;\n          let data = res.data;\n          this.title = data.title;\n          this.content = data.content;\n          if (\n            data.voteInfoDTO != null &&\n            typeof data.voteInfoDTO != undefined\n          ) {\n            let vote = {\n              id: data.voteInfoDTO.voteId,\n              enable: true,\n              topic: data.voteInfoDTO.topic,\n              voteOptions: data.voteInfoDTO.options.map((item) => {\n                return { value: item.optionName };\n              }),\n            };\n            this.vote = JSON.parse(JSON.stringify(vote));\n          }\n          if (isNew) return;\n          if (\n            !data.attachments ||\n            typeof data.attachments == \"undefined\" ||\n            data.attachments.length > 0\n          ) {\n            console.debug(\"attachments:\" + JSON.stringify(data.attachments));\n            data.attachments.forEach((item) => {\n              let fileName = getUploadRealFileNameByPath(item.url);\n              let temp = {\n                res: true,\n                text: fileName,\n                fileType: checkUploadFileType(fileName),\n                path: item.url,\n                progress: 100,\n                orientation: item.orientation,\n                uploadSize: item.attachmentSize,\n                fileSize: readFileSizeUnit(item.attachmentSize),\n              };\n              if (item.orientation == null) {\n                this.uploadFileNormal.push(temp);\n              } else {\n                this.uploadFileDirect.push(temp);\n              }\n            });\n          }\n        })\n        .catch();\n    },\n    clearContent() {\n      this.title = \"\";\n      this.content = \"\";\n      this.vote = voteDefault;\n      this.voteTemp = voteDefault;\n      this.uploadFileNormal = [];\n      this.uploadFileDirect = [];\n    },\n    // *-------------------投票操作---------------------------*/\n    //确认保存投票\n\n    voteSave: Throttle(\n      function () {\n        console.log(this.$refs.form);\n        if (!this.$refs.form.validate()) return;\n\n        let temp = this.voteTemp;\n        temp.enable = true;\n        temp.voteOptions = temp.voteOptions.filter(\n          (t) => t.value != null && t.value != \"\"\n        );\n\n        let upload = {};\n        upload.id = temp.id;\n        upload.topic = temp.topic;\n        upload.voteType = temp.voteType ? 1 : 0;\n        upload.voteOptions = temp.voteOptions.map((item) => item.value);\n        upload.endTime = temp.endTime;\n\n        saveVote(upload)\n          .then((res) => {\n            console.debug(\"save vote ==>\" + JSON.stringify(res));\n            if (res.code == 0) {\n              this.voteDialog = false;\n              console.debug(\"save id\" + res.data.voteId);\n              temp.id = res.data.voteId;\n              this.vote = JSON.parse(JSON.stringify(temp));\n              this.voteTemp = JSON.parse(JSON.stringify(temp));\n              this.changeSaveStatus();\n            }\n          })\n          .catch(() => this.showSnack(\"添加投票失败\"));\n      },\n      function () {\n        this.showSnack(\"您提交的太频繁了，稍等一会试试吧\");\n      }\n    ),\n    //添加投票选项\n    addItem() {\n      this.voteTemp.voteOptions.push({ value: null });\n    },\n    //删除投票选项\n    deleteItem: function (index) {\n      //  not allow to delete the first\n      if (index > 1) {\n        this.voteTemp.voteOptions.splice(index, 1);\n      }\n    },\n    onVoteDelete() {\n      this.vote.enable = false;\n      this.changeSaveStatus();\n    },\n\n    /*-------------------附件上传操作---------------------------*/\n    uploadFileN() {\n      //this.$refs.uploadFileN.dispatchEvent(new MouseEvent(\"click\"));\n      this.$refs.uploadFileN.click();\n    },\n    uploadFileD() {\n      this.$refs.uploadFileD.click();\n    },\n\n    onDeleteFile(index, isDirectFile) {\n      if (isDirectFile) {\n        this.uploadFileDirect.splice(index, 1);\n      } else {\n        this.uploadFileNormal.splice(index, 1);\n      }\n    },\n\n    fileUpload(event, direct) {\n      let upFiles = direct ? this.uploadFileDirect : this.uploadFileNormal;\n      let file = event.target.files;\n\n      if (!direct && file.length + this.uploadFileNormal.length > 3) {\n        return;\n      }\n      for (let i = 0; i < file.length; i++) {\n        let item = file[i];\n        item.direct = direct;\n\n        //上传文件去重\n        if (upFiles.findIndex((t) => t.text == item.name) >= 0) {\n          continue;\n        }\n\n        //上传类型判断\n        let ext = checkUploadFileType(item.name);\n        if (ext == null) continue;\n\n        let temp = {};\n        temp.text = item.name;\n        temp.fileType = ext;\n        temp.res = false;\n        temp.fileSize = readFileSizeUnit(item.size);\n        temp.uploadSize = item.size;\n        if (direct) {\n          temp.orientation = getDistributorNumberByFileName(item.name);\n          if (\n            temp.orientation == null ||\n            typeof temp.orientation == \"undefined\" ||\n            temp.orientation == \"\"\n          ) {\n            temp.error = \"文件名不符合要求\";\n            upFiles.push(temp);\n            continue;\n          }\n        }\n        upFiles.push(temp);\n\n        if (direct) {\n          this.uploadDirectImp(item, temp);\n        } else {\n          this.uploadNormalImp(item);\n        }\n      }\n    },\n\n    uploadNormalImp(item) {\n      uploadFile(item, (progress, fileName) => {\n        var index = this.uploadFileNormal.findIndex((t) => t.text == fileName);\n        if (index < 0) return;\n        this.uploadFileNormal[index].progress = progress;\n\n        this.uploadFileNormal = JSON.parse(\n          JSON.stringify(this.uploadFileNormal)\n        );\n      })\n        .then((res) => {\n          let index = this.uploadFileNormal.findIndex(\n            (t) => t.text == item.name\n          );\n          let update = this.uploadFileNormal[index];\n          if (!res || typeof res == \"undefined\" || res.code != 0) {\n            update[index].error = \"上传失败\";\n          } else {\n            update.path = res.data;\n            update.res = true;\n          }\n        })\n        .catch(() => {\n          let index = this.uploadFileNormal.findIndex(\n            (t) => t.text == item.name\n          );\n          this.uploadFileNormal[index].error = \"上传失败\";\n        })\n        .finally(\n          () =>\n            (this.uploadFileNormal = JSON.parse(\n              JSON.stringify(this.uploadFileNormal)\n            ))\n        );\n    },\n    uploadDirectImp(item, temp) {\n      dealerCodeValid(temp.orientation)\n        .then((res) => {\n          if (!res || typeof res == \"undefined\" || res.code != 0) {\n            temp.error = \"文件名不符合要求\";\n          } else {\n            var index = this.uploadFileDirect.findIndex(\n              (t) => t.text == item.name\n            );\n            if (index < 0) return;\n\n            uploadFile(item, (progress, fileName) => {\n              var index = this.uploadFileDirect.findIndex(\n                (t) => t.text == fileName\n              );\n              if (index < 0) return;\n              this.uploadFileDirect[index].progress = progress;\n\n              this.uploadFileDirect = JSON.parse(\n                JSON.stringify(this.uploadFileDirect)\n              );\n            })\n              .then((res) => {\n                let index = this.uploadFileDirect.findIndex(\n                  (t) => t.text == item.name\n                );\n                let update = this.uploadFileDirect[index];\n                if (!res || typeof res == \"undefined\" || res.code != 0) {\n                  update[index].error = \"上传失败\";\n                } else {\n                  update.path = res.data;\n                  update.res = true;\n                }\n                this.caculateDelearList();\n              })\n              .catch(() => {\n                let index = this.uploadFileDirect.findIndex(\n                  (t) => t.text == item.name\n                );\n                this.uploadFileDirect[index].error = \"上传失败\";\n              })\n              .finally(\n                () =>\n                  (this.uploadFileDirect = JSON.parse(\n                    JSON.stringify(this.uploadFileDirect)\n                  ))\n              );\n          }\n        })\n        .catch(() => {\n          var index = this.uploadFileDirect.findIndex(\n            (t) => t.text == item.name\n          );\n          this.uploadFileDirect[index].error = \"文件名不符合要求\";\n          console.log(JSON.stringify(this.uploadFileDirect));\n        })\n        .finally(\n          () =>\n            (this.uploadFileDirect = JSON.parse(\n              JSON.stringify(this.uploadFileDirect)\n            ))\n        );\n    },\n\n    /*-------------------保存草稿操作---------------------------*/\n\n    saveArticle: Throttle(\n      function () {\n        this.saveArticleImp();\n      },\n      function () {\n        this.showSnack(\"您提交的太频繁了，稍等一会试试吧\");\n      }\n    ),\n    autoSave: Debounce(function () {\n      if (this.needSave) {\n        this.autoSaving = true;\n        this.saveArticleImp();\n      }\n    }, 10000),\n\n    saveArticleImp() {\n      if (!this.precondition()) {\n        this.autoSaving = false;\n        return;\n      }\n      let attachmentLists = [];\n      this.uploadFileNormal.forEach((item) => {\n        let temp = {};\n        temp.path = item.path;\n        temp.attachmentSize = item.fileSize;\n        attachmentLists.push(temp);\n      });\n      this.uploadFileDirect.forEach((item) => {\n        let temp = {};\n        temp.path = item.path;\n        temp.orientation = item.orientation;\n        temp.attachmentSize = item.uploadSize;\n        attachmentLists.push(temp);\n      });\n      let data = {\n        id: this.id,\n        title: this.title,\n        content: this.content,\n        voteId: this.vote.id,\n        attachmentList: attachmentLists,\n      };\n\n      saveMessage(data)\n        .then((res) => {\n          console.log(res);\n          if (res.code == 0) {\n            this.needSave = false;\n            this.showSnack(this.autoSaving ? \"自动保存成功\" : \"保存成功\");\n\n            if (this.id != res.data) {\n              this.id = res.data;\n\n              this.$router.replace({\n                query: { id: window.btoa(this.id) },\n              });\n            }\n          } else {\n            if (!this.autoSaving) this.showSnack(\"保存失败\");\n          }\n        })\n        .catch((error) => {\n          if (error.response == null || typeof error.response == \"undefined\") {\n            if (!this.autoSaving) this.showSnack(\"保存失败\");\n            return;\n          }\n          let res = error.response;\n          if (res.data == null || typeof res.data == \"undefined\") {\n            if (!this.autoSaving) this.showSnack(\"保存失败\");\n            return;\n          }\n          let data = res.data;\n          if (\n            data.code == null ||\n            typeof data.code == \"undefined\" ||\n            data.code != 4\n          ) {\n            if (!this.autoSaving) this.showSnack(\"保存失败\");\n            return;\n          }\n\n          let sensitiveWords = data.data;\n          if (\n            sensitiveWords == null ||\n            typeof sensitiveWords == \"undefined\" ||\n            sensitiveWords.length == 0\n          ) {\n            if (!this.autoSaving) this.showSnack(\"保存失败\");\n            return;\n          } else {\n            if (this.autoSaving) return;\n            this.showSnack(\"文章中包含敏感词\");\n            console.debug(\"error\" + JSON.stringify(sensitiveWords));\n            let titleError = [];\n            sensitiveWords.forEach((word) => {\n              if (this.title.indexOf(word) >= 0) {\n                titleError.push(word);\n              }\n              this.content = highLightAllText(this.content, word);\n            });\n            if (titleError.length > 0) {\n              this.titleErrorMessage = \"包含敏感词:\";\n              titleError.forEach((word) => {\n                this.titleErrorMessage += word + \" \";\n              });\n            }\n          }\n        })\n        .finally(() => (this.autoSaving = false));\n    },\n    caculateDelearList() {\n      this.delearList = [];\n      console.log(JSON.stringify(this.uploadFileDirect));\n      this.uploadFileDirect.forEach((item) => {\n        if (\n          item.res &&\n          (item.error == null || typeof item.error == \"undefined\")\n        ) {\n          this.delearList.push(item.orientation);\n        }\n      });\n      console.log(this.delearList);\n    },\n\n    publishArticle() {\n      if (this.needSave) {\n        this.showSnack(\"您有修改未保存，请保存后再进行发布。\");\n        return;\n      }\n      if (!this.precondition()) return;\n      this.publish = true;\n    },\n\n    precondition() {\n      let error = null;\n      if (isNull(this.title)) {\n        if (!this.autoSaving) {\n          error = this.titleErrorMessage = \"标题不能为空\";\n          this.showSnack(error);\n        }\n\n        return false;\n      }\n      if (isNull(this.content)) {\n        if (!this.autoSaving) this.showSnack(\"正文内容不能为空\");\n        return false;\n      }\n      this.uploadFileDirect.findIndex((item) => {\n        if (item.error != null) {\n          error = item.error;\n          return true;\n        }\n        if (item.res == false) {\n          error = \"请等待文件上传完成\";\n          return true;\n        }\n      });\n      if (error != null && !this.autoSaving) {\n        this.showSnack(error);\n        return false;\n      }\n      this.uploadFileNormal.forEach((item) => {\n        if (item.error != null) {\n          error = item.error;\n          return true;\n        }\n        if (item.res == false) {\n          error = \"请等待文件上传完成\";\n          return true;\n        }\n      });\n      if (error != null && !this.autoSaving) {\n        this.showSnack(error);\n        return false;\n      }\n      return true;\n    },\n    showSnack(message) {\n      if (\n        this.preview ||\n        this.publish ||\n        this.$route.path != \"/publishArticle\"\n      ) {\n        return;\n      }\n      showSnackbar(message);\n    },\n    closeSnack() {\n      closeSnackbar();\n    },\n\n    changeSaveStatus() {\n      this.needSave = true;\n      this.autoSave();\n    },\n  },\n  watch: {\n    content() {\n      this.changeSaveStatus();\n    },\n    title() {\n      this.titleErrorMessage = \"\";\n      this.changeSaveStatus();\n    },\n  },\n};\n</script>\n<style>\n.publish_content {\n  display: block;\n  overflow: scroll;\n}\n.append-content .v-btn {\n  color: #1867c0ff;\n  font-family: PingFang SC;\n  font-weight: regular;\n  font-size: 12px;\n  line-height: 18px;\n  letter-spacing: 0px;\n  text-align: left;\n  vertical-align: top;\n}\n\n.append-content\n  .v-btn--plain:not(.v-btn--active):not(.v-btn--loading):not(:focus):not(:hover)\n  .v-btn__content {\n  opacity: 1;\n}\n\n.appendix .v-icon {\n  margin-left: 0px !important;\n  margin-right: 4px !important;\n}\n\n.appendix .divider {\n  display: inline-block;\n  width: 1px;\n  height: 12px;\n  background: #e4e8ebff;\n  margin-bottom: 3px;\n}\n\n.appendix-hint {\n  display: inline-block;\n  color: #999999ff;\n  height: 18px;\n  font-family: PingFang SC;\n  font-weight: regular;\n  font-size: 12px;\n  line-height: normal;\n  letter-spacing: 0px;\n  text-align: left;\n  margin-left: 8px;\n  vertical-align: top;\n}\n\n/* vote dialog */\n.vote-option .v-btn {\n  color: #1867c0ff;\n  font-family: PingFang SC;\n  font-weight: regular;\n  font-size: 14px;\n  line-height: 18px;\n  letter-spacing: 0px;\n  text-align: left;\n  vertical-align: top;\n}\n\n.vote-option\n  .v-btn--plain:not(.v-btn--active):not(.v-btn--loading):not(:focus):not(:hover)\n  .v-btn__content {\n  opacity: 1;\n}\n\n.vote-checkbox-label {\n  color: #333333ff;\n  font-family: PingFang SC;\n  font-weight: regular;\n  font-size: 14px;\n  line-height: normal;\n  letter-spacing: 0px;\n  text-align: left;\n  margin-right: 8px;\n}\n\n.vote-checkbox {\n  display: inline-flex;\n  font-size: 14px;\n  margin: 0 !important;\n  padding: 0 !important;\n  margin-top: 3px !important;\n}\n\n.vote-checkbox .v-input__slot {\n  margin-bottom: 0 !important;\n  padding-right: 0;\n}\n.vote-checkbox .v-input__control {\n  height: 14px !important;\n}\n\n.vote-checkbox .v-input--selection-controls__input {\n  padding: 0;\n  margin: 0;\n  height: 14px !important;\n  width: 14px !important;\n}\n/* vote dialog */\n\n.files-category {\n  opacity: 0.800000011920929;\n  color: #333333ff;\n  font-family: PingFang SC;\n  font-weight: semibold;\n  font-size: 14px;\n  line-height: 20px;\n  letter-spacing: 0px;\n}\n\n.file-item {\n  margin-bottom: 1px;\n}\n\n.time_input .v-input__slot {\n  padding-right: 0px !important;\n}\n</style>\n"]}]}