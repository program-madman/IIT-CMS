{"remainingRequest":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/babel-loader/lib/index.js!/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/eslint-loader/index.js??ref--13-0!/Users/liuguanghui/Documents/cms_code/my-message/cms/src/utils/download.js","dependencies":[{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/src/utils/download.js","mtime":1638535920900},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/liuguanghui/Documents/cms_code/my-message/cms/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgSlNaaXAgZnJvbSAianN6aXAiOwppbXBvcnQgRmlsZVNhdmVyIGZyb20gImZpbGUtc2F2ZXIiOwppbXBvcnQgeyBkb3duRmlsZSB9IGZyb20gIi4uL2FwaS9nZXREYXRhLmpzIjsKZXhwb3J0IHZhciBkb3dubG9hZEZpbGUgPSBmdW5jdGlvbiBkb3dubG9hZEZpbGUoYXBGaWxlKSB7CiAgdmFyIG5hbWUgPSBhcEZpbGUudXJsLnNsaWNlKGFwRmlsZS51cmwubGFzdEluZGV4T2YoIi8iKSArIDEpOwogIHZhciBkYXRhID0gewogICAgImF0dGFjaG1lbnRJZCI6IGFwRmlsZS5pZAogIH07CiAgZG93bkZpbGUoZGF0YSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICBGaWxlU2F2ZXIuc2F2ZUFzKHJlcywgbmFtZSk7CiAgfSk7Cn07Ci8qKgogKiDkuIvovb3lhajpg6gKICogQHBhcmFtIHsqfSBmaWxlcyAKICogQHBhcmFtIHsqfSBmaWxlTmFtZSAKICogQHBhcmFtIHsqfSBjYWxsYmFjayAw5Li65byA5aeL5YiG5Liq5LiL6L295paH5Lu277yMMeS4uuW8gOWni+aJk+WMhe+8jDLkuLrmiZPljIXljovnvKnlrozmiJDvvIwz5Li65LiL6L295a6M5oiQCiAqLwoKZXhwb3J0IHZhciBkb3dubG9hZEFsbCA9IGZ1bmN0aW9uIGRvd25sb2FkQWxsKGZpbGVzLCBmaWxlTmFtZSwgY2FsbGJhY2spIHsKICBjb25zb2xlLmxvZygi5omT5YyF5Y6L57yp5Lul5LiL5paH5Lu2OiIgKyBKU09OLnN0cmluZ2lmeShmaWxlcykpOwogIGNhbGxiYWNrKDApOwogIHZhciB6aXAgPSBuZXcgSlNaaXAoKTsKICB2YXIgcHJvbWlzZXMgPSBbXTsgLy/nlKjkuo7lrZjlgqjlpJrkuKpwcm9taXNlCgogIGZpbGVzLmZvckVhY2goZnVuY3Rpb24gKGFwRmlsZSkgewogICAgdmFyIG5hbWUgPSBhcEZpbGUudXJsLnNsaWNlKGFwRmlsZS51cmwubGFzdEluZGV4T2YoIi8iKSArIDEpOwogICAgdmFyIGRhdGEgPSB7CiAgICAgICJhdHRhY2htZW50SWQiOiBhcEZpbGUuaWQKICAgIH07CiAgICB2YXIgcHJvbWlzZSA9IGRvd25GaWxlKGRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICB6aXAuZmlsZShuYW1lLCByZXMsIHsKICAgICAgICBiaW5hcnk6IHRydWUKICAgICAgfSk7CiAgICB9KTsKICAgIHByb21pc2VzLnB1c2gocHJvbWlzZSk7CiAgfSk7CiAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgY2FsbGJhY2soMSk7CiAgICB6aXAuZ2VuZXJhdGVBc3luYyh7CiAgICAgIHR5cGU6ICJibG9iIiwKICAgICAgY29tcHJlc3Npb246ICJERUZMQVRFIiwKICAgICAgLy8gU1RPUkXvvJrpu5jorqTkuI3ljovnvKkgREVGTEFURe+8mumcgOimgeWOi+e8qQogICAgICBjb21wcmVzc2lvbk9wdGlvbnM6IHsKICAgICAgICBsZXZlbDogOSAvLyDljovnvKnnrYnnuqcxfjkgICAgMeWOi+e8qemAn+W6puacgOW/q++8jDnmnIDkvJjljovnvKnmlrnlvI8KCiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICBjYWxsYmFjaygyKTsKICAgICAgRmlsZVNhdmVyLnNhdmVBcyhyZXMsIGZpbGVOYW1lID8gZmlsZU5hbWUgOiAi5Y6L57yp5YyFLnppcCIpOyAvLyDliKnnlKhmaWxlLXNhdmVy5L+d5a2Y5paH5Lu2CgogICAgICBjYWxsYmFjaygzKTsKICAgIH0pOwogIH0pOwp9Ow=="},{"version":3,"sources":["/Users/liuguanghui/Documents/cms_code/my-message/cms/src/utils/download.js"],"names":["JSZip","FileSaver","downFile","downloadFile","apFile","name","url","slice","lastIndexOf","data","id","then","res","saveAs","downloadAll","files","fileName","callback","console","log","JSON","stringify","zip","promises","forEach","promise","file","binary","push","Promise","all","generateAsync","type","compression","compressionOptions","level"],"mappings":";;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAAQC,QAAR,QAAuB,mBAAvB;AACA,OAAO,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAACC,MAAD,EAAY;AACtC,MAAIC,IAAI,GAAGD,MAAM,CAACE,GAAP,CAAWC,KAAX,CAAiBH,MAAM,CAACE,GAAP,CAAWE,WAAX,CAAuB,GAAvB,IAA8B,CAA/C,CAAX;AACA,MAAIC,IAAI,GAAG;AACT,oBAAgBL,MAAM,CAACM;AADd,GAAX;AAGAR,EAAAA,QAAQ,CAACO,IAAD,CAAR,CAAeE,IAAf,CAAoB,UAACC,GAAD,EAAS;AAC3BX,IAAAA,SAAS,CAACY,MAAV,CAAiBD,GAAjB,EAAsBP,IAAtB;AACH,GAFC;AAGD,CARM;AASP;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,IAAMS,WAAW,GAAG,SAAdA,WAAc,CAACC,KAAD,EAAQC,QAAR,EAAiBC,QAAjB,EAA8B;AACrDC,EAAAA,OAAO,CAACC,GAAR,CAAY,cAAYC,IAAI,CAACC,SAAL,CAAeN,KAAf,CAAxB;AACAE,EAAAA,QAAQ,CAAC,CAAD,CAAR;AACA,MAAMK,GAAG,GAAG,IAAItB,KAAJ,EAAZ;AACA,MAAMuB,QAAQ,GAAG,EAAjB,CAJqD,CAI/B;;AACtBR,EAAAA,KAAK,CAACS,OAAN,CAAc,UAACpB,MAAD,EAAY;AACtB,QAAIC,IAAI,GAAGD,MAAM,CAACE,GAAP,CAAWC,KAAX,CAAiBH,MAAM,CAACE,GAAP,CAAWE,WAAX,CAAuB,GAAvB,IAA8B,CAA/C,CAAX;AACA,QAAIC,IAAI,GAAG;AACT,sBAAgBL,MAAM,CAACM;AADd,KAAX;AAGA,QAAMe,OAAO,GAAGvB,QAAQ,CAACO,IAAD,CAAR,CAAeE,IAAf,CAAoB,UAACC,GAAD,EAAS;AACzCU,MAAAA,GAAG,CAACI,IAAJ,CAASrB,IAAT,EAAeO,GAAf,EAAoB;AAACe,QAAAA,MAAM,EAAE;AAAT,OAApB;AACH,KAFe,CAAhB;AAGAJ,IAAAA,QAAQ,CAACK,IAAT,CAAcH,OAAd;AACH,GATD;AAWAI,EAAAA,OAAO,CAACC,GAAR,CAAYP,QAAZ,EAAsBZ,IAAtB,CAA2B,YAAM;AAC7BM,IAAAA,QAAQ,CAAC,CAAD,CAAR;AACAK,IAAAA,GAAG,CAACS,aAAJ,CAAkB;AAChBC,MAAAA,IAAI,EAAE,MADU;AAEhBC,MAAAA,WAAW,EAAE,SAFG;AAES;AACzBC,MAAAA,kBAAkB,EAAE;AAClBC,QAAAA,KAAK,EAAE,CADW,CACK;;AADL;AAHJ,KAAlB,EAMGxB,IANH,CAMQ,UAACC,GAAD,EAAS;AACfK,MAAAA,QAAQ,CAAC,CAAD,CAAR;AACAhB,MAAAA,SAAS,CAACY,MAAV,CAAiBD,GAAjB,EAAsBI,QAAQ,GAAGA,QAAH,GAAc,SAA5C,EAFe,CAEwC;;AACvDC,MAAAA,QAAQ,CAAC,CAAD,CAAR;AACD,KAVD;AAWH,GAbD;AAeH,CA/BM","sourcesContent":["import JSZip from \"jszip\";\nimport FileSaver from \"file-saver\";\nimport {downFile} from \"../api/getData.js\";\nexport const downloadFile = (apFile) => {\n  let name = apFile.url.slice(apFile.url.lastIndexOf(\"/\") + 1);\n  let data = {\n    \"attachmentId\": apFile.id\n  }\n  downFile(data).then((res) => {\n    FileSaver.saveAs(res, name) \n})\n}\n/**\n * 下载全部\n * @param {*} files \n * @param {*} fileName \n * @param {*} callback 0为开始分个下载文件，1为开始打包，2为打包压缩完成，3为下载完成\n */\nexport const downloadAll = (files, fileName,callback) => {\n    console.log(\"打包压缩以下文件:\"+JSON.stringify(files));\n    callback(0)\n    const zip = new JSZip();\n    const promises = [];  //用于存储多个promise\n    files.forEach((apFile) => {\n        let name = apFile.url.slice(apFile.url.lastIndexOf(\"/\") + 1);\n        let data = {\n          \"attachmentId\": apFile.id\n        }\n        const promise = downFile(data).then((res) => {\n            zip.file(name, res ,{binary: true});\n        })\n        promises.push(promise)\n    })\n    \n    Promise.all(promises).then(() => {\n        callback(1)\n        zip.generateAsync({\n          type: \"blob\",\n          compression: \"DEFLATE\",  // STORE：默认不压缩 DEFLATE：需要压缩\n          compressionOptions: {\n            level: 9               // 压缩等级1~9    1压缩速度最快，9最优压缩方式\n          }\n        }).then((res) => {\n          callback(2)\n          FileSaver.saveAs(res, fileName ? fileName : \"压缩包.zip\") // 利用file-saver保存文件\n          callback(3)\n        })\n    })\n    \n}"]}]}