{"remainingRequest":"/Users/liuguanghui/Documents/IIT/2023 summary course/iit-project/IIT-CMS/front/cms/node_modules/babel-loader/lib/index.js!/Users/liuguanghui/Documents/IIT/2023 summary course/iit-project/IIT-CMS/front/cms/node_modules/eslint-loader/index.js??ref--13-0!/Users/liuguanghui/Documents/IIT/2023 summary course/iit-project/IIT-CMS/front/cms/src/utils/download.js","dependencies":[{"path":"/Users/liuguanghui/Documents/IIT/2023 summary course/iit-project/IIT-CMS/front/cms/src/utils/download.js","mtime":1641453010575},{"path":"/Users/liuguanghui/Documents/IIT/2023 summary course/iit-project/IIT-CMS/front/cms/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liuguanghui/Documents/IIT/2023 summary course/iit-project/IIT-CMS/front/cms/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/liuguanghui/Documents/IIT/2023 summary course/iit-project/IIT-CMS/front/cms/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0IEpTWmlwIGZyb20gImpzemlwIjsKaW1wb3J0IEZpbGVTYXZlciBmcm9tICJmaWxlLXNhdmVyIjsKaW1wb3J0IHsgZG93bkZpbGUgfSBmcm9tICIuLi9hcGkvZ2V0RGF0YS5qcyI7CmV4cG9ydCB2YXIgZG93bmxvYWRGaWxlID0gZnVuY3Rpb24gZG93bmxvYWRGaWxlKGFwRmlsZSkgewogIGNvbnNvbGUubG9nKCJhcEZpbGU6IiArIEpTT04uc3RyaW5naWZ5KGFwRmlsZSkpOwogIHZhciBuYW1lID0gYXBGaWxlLmF0dGFjaG1lbnROYW1lID09PSAiIiA/IGFwRmlsZS51cmwuc2xpY2UoYXBGaWxlLnVybC5sYXN0SW5kZXhPZigiLyIpICsgMSkgOiBhcEZpbGUuYXR0YWNobWVudE5hbWU7CiAgdmFyIGRhdGEgPSB7CiAgICAiYXR0YWNobWVudElkIjogYXBGaWxlLmF0dGFjaG1lbnRJZCA/IGFwRmlsZS5hdHRhY2htZW50SWQgOiBhcEZpbGUuaWQKICB9OwogIGRvd25GaWxlKGRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgRmlsZVNhdmVyLnNhdmVBcyhyZXMsIG5hbWUpOwogIH0pOwp9OwovKioKICog6YCa6L+HVVJM5LiL6L29CiAqIAogKi8KCmV4cG9ydCB2YXIgZG93bmxvYWRGaWxlQnlVcmwgPSBmdW5jdGlvbiBkb3dubG9hZEZpbGVCeVVybCh1cmwpIHsKICBjb25zb2xlLmxvZygiZG93bmxvYWRGaWxlQnlVcmw6IiArIHVybCk7CiAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgYS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIGEuaHJlZiA9IHVybDsgLy9hLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLGZpbGVOYW1lKTsKCiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICBhLmNsaWNrKCk7IC8v5omn6KGM5LiL6L29CgogIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKGEuaHJlZik7CiAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhKTsKfTsKLyoqCiAqIOS4i+i9veWFqOmDqAogKiBAcGFyYW0geyp9IGZpbGVzIAogKiBAcGFyYW0geyp9IGZpbGVOYW1lIAogKiBAcGFyYW0geyp9IGNhbGxiYWNrIDDkuLrlvIDlp4vliIbkuKrkuIvovb3mlofku7bvvIwx5Li65byA5aeL5omT5YyF77yMMuS4uuaJk+WMheWOi+e8qeWujOaIkO+8jDPkuLrkuIvovb3lrozmiJAKICovCgpleHBvcnQgdmFyIGRvd25sb2FkQWxsID0gZnVuY3Rpb24gZG93bmxvYWRBbGwoZmlsZXMsIGZpbGVOYW1lLCBjYWxsYmFjaykgewogIGNvbnNvbGUubG9nKCLmiZPljIXljovnvKnku6XkuIvmlofku7Y6IiArIEpTT04uc3RyaW5naWZ5KGZpbGVzKSk7CiAgY2FsbGJhY2soMCk7CiAgdmFyIHppcCA9IG5ldyBKU1ppcCgpOwogIHZhciBwcm9taXNlcyA9IFtdOyAvL+eUqOS6juWtmOWCqOWkmuS4qnByb21pc2UKCiAgZmlsZXMuZm9yRWFjaChmdW5jdGlvbiAoYXBGaWxlKSB7CiAgICB2YXIgbmFtZSA9IGFwRmlsZS5hdHRhY2htZW50TmFtZSA9PT0gIiIgPyBhcEZpbGUudXJsLnNsaWNlKGFwRmlsZS51cmwubGFzdEluZGV4T2YoIi8iKSArIDEpIDogYXBGaWxlLmF0dGFjaG1lbnROYW1lOwogICAgdmFyIGRhdGEgPSB7CiAgICAgICJhdHRhY2htZW50SWQiOiBhcEZpbGUuYXR0YWNobWVudElkID8gYXBGaWxlLmF0dGFjaG1lbnRJZCA6IGFwRmlsZS5pZAogICAgfTsKICAgIHZhciBwcm9taXNlID0gZG93bkZpbGUoZGF0YSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgIHppcC5maWxlKG5hbWUsIHJlcywgewogICAgICAgIGJpbmFyeTogdHJ1ZQogICAgICB9KTsKICAgIH0pOwogICAgcHJvbWlzZXMucHVzaChwcm9taXNlKTsKICB9KTsKICBQcm9taXNlLmFsbChwcm9taXNlcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICBjYWxsYmFjaygxKTsKICAgIHppcC5nZW5lcmF0ZUFzeW5jKHsKICAgICAgdHlwZTogImJsb2IiLAogICAgICBjb21wcmVzc2lvbjogIkRFRkxBVEUiLAogICAgICAvLyBTVE9SRe+8mum7mOiupOS4jeWOi+e8qSBERUZMQVRF77ya6ZyA6KaB5Y6L57ypCiAgICAgIGNvbXByZXNzaW9uT3B0aW9uczogewogICAgICAgIGxldmVsOiA5IC8vIOWOi+e8qeetiee6pzF+OSAgICAx5Y6L57yp6YCf5bqm5pyA5b+r77yMOeacgOS8mOWOi+e8qeaWueW8jwoKICAgICAgfQogICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgIGNhbGxiYWNrKDIpOwogICAgICBGaWxlU2F2ZXIuc2F2ZUFzKHJlcywgZmlsZU5hbWUgPyBmaWxlTmFtZSA6ICLljovnvKnljIUuemlwIik7IC8vIOWIqeeUqGZpbGUtc2F2ZXLkv53lrZjmlofku7YKCiAgICAgIGNhbGxiYWNrKDMpOwogICAgfSk7CiAgfSk7Cn07"},{"version":3,"sources":["/Users/liuguanghui/Documents/IIT/2023 summary course/iit-project/IIT-CMS/front/cms/src/utils/download.js"],"names":["JSZip","FileSaver","downFile","downloadFile","apFile","console","log","JSON","stringify","name","attachmentName","url","slice","lastIndexOf","data","attachmentId","id","then","res","saveAs","downloadFileByUrl","a","document","createElement","style","display","href","body","appendChild","click","window","URL","revokeObjectURL","removeChild","downloadAll","files","fileName","callback","zip","promises","forEach","promise","file","binary","push","Promise","all","generateAsync","type","compression","compressionOptions","level"],"mappings":"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","sourcesContent":["import JSZip from \"jszip\";\nimport FileSaver from \"file-saver\";\nimport {downFile} from \"../api/getData.js\";\nexport const downloadFile = (apFile) => {\n    console.log(\"apFile:\"+JSON.stringify(apFile)); \n\n    let name = apFile.attachmentName  === \"\" ? apFile.url.slice(apFile.url.lastIndexOf(\"/\") + 1) : apFile.attachmentName;\n    let data = {\n      \"attachmentId\": apFile.attachmentId ? apFile.attachmentId : apFile.id\n    }\n    \n    downFile(data).then((res) => {\n      FileSaver.saveAs(res, name) \n    })\n}\n\n/**\n * 通过URL下载\n * \n */\nexport const downloadFileByUrl = (url) => {\n    console.log(\"downloadFileByUrl:\"+url);\n    let a = document.createElement('a');\n    a.style.display = 'none';\n    a.href = url;\n    //a.setAttribute('download',fileName);\n    document.body.appendChild(a);\n    a.click(); //执行下载\n    window.URL.revokeObjectURL(a.href);\n    document.body.removeChild(a);\n}\n\n/**\n * 下载全部\n * @param {*} files \n * @param {*} fileName \n * @param {*} callback 0为开始分个下载文件，1为开始打包，2为打包压缩完成，3为下载完成\n */\nexport const downloadAll = (files, fileName,callback) => {\n    console.log(\"打包压缩以下文件:\"+JSON.stringify(files));\n    callback(0)\n    const zip = new JSZip();\n    const promises = [];  //用于存储多个promise\n    files.forEach((apFile) => {\n        let name = apFile.attachmentName  === \"\" ? apFile.url.slice(apFile.url.lastIndexOf(\"/\") + 1) : apFile.attachmentName;\n        let data = {\n          \"attachmentId\": apFile.attachmentId ? apFile.attachmentId : apFile.id\n        }\n        const promise = downFile(data).then((res) => {\n            zip.file(name, res ,{binary: true});\n        })\n        promises.push(promise)\n    })\n    \n    Promise.all(promises).then(() => {\n        callback(1)\n        zip.generateAsync({\n          type: \"blob\",\n          compression: \"DEFLATE\",  // STORE：默认不压缩 DEFLATE：需要压缩\n          compressionOptions: {\n            level: 9               // 压缩等级1~9    1压缩速度最快，9最优压缩方式\n          }\n        }).then((res) => {\n          callback(2)\n          FileSaver.saveAs(res, fileName ? fileName : \"压缩包.zip\") // 利用file-saver保存文件\n          callback(3)\n        })\n    })\n    \n}"]}]}